<html>

<head>
    <title>My First Web Page</title>
    <script src="dist/bundle.js"></script>
</head>

<body>

</body>
<script>
    const beatMS = 2000;
    const beep = (freq = 320, duration = 100, vol = 5) => {
        const oscillator = context.createOscillator();
        const gain = context.createGain();
        oscillator.connect(gain);
        oscillator.frequency.value = freq;
        oscillator.type = "square";
        gain.connect(context.destination);
        gain.gain.value = vol * 0.01;
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + duration * 0.001);
    }
    const playChord = (notes, length, volMultiplier) => {
        context = new AudioContext();
        volMultiplier = volMultiplier || 1;
        return new Promise((resolve) => {
            let index = 0
            for (const note of notes) {
                const freq = note
                let vol = 2;
                if (index == 0) {
                    vol = 5
                }
                if (index == 2) {
                    vol = 5
                }
                beep(freq, length, vol * volMultiplier)
                index++;
            }
            setTimeout(resolve, length)
        })
    }
    const runChords = async function() {
        for (const chord of window.chords) {
            await playChord(chord, beatMS)
        }
    }
    const playMelody = async function() {
        for (const tick in window.melody) {
            setTimeout(() => {
                const note = window.melody[tick]
                if (note) {
                    beep(note.freq, beatMS / 12 * note.duration, 10)
                }
            }, beatMS / 12 * tick)
        }
    }
    runChords();
    playMelody();
</script>

</html>